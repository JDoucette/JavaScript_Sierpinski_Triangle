<!DOCTYPE html>
<!--
ORIGINAL:	Michael Pohoreski <michael.pohoreski@gmail.com>
			Jan 9, 2015, 11:26 PM
			Email subject: Re: What's your favorite “programmer” cartoon?
MODIFIED:	Jason Allen Doucette
			Jan 12, 2019, 1:58 am
-->
<html>
	<head>
		<title>Sierpinski Triangle</title>
	</head>
	<!-- 
		DOESN'T WORK WITH htmlpreview.github.io 
		Note: requires function is already defined (move SCRIPT into HEAD).
	-->
	<!-- <body onload="main_function()"> -->
	<body>
		<canvas id="MyCanvas" width="1536" height="1536"></canvas>
		<script>
			"use strict";

			// graphics
			var hCanvas  = undefined;
			var hContext = undefined;
			var nCanvasW = 0;
			var nCanvasH = 0;
			var tImage   = undefined;
			var aTexels  = undefined;

			// timer
			var nTimerId = 0;
			
			// points
			//var nPoints = 3;  // Sierpinski Triangle
			var nPoints = 5;
			var px = new Array(nPoints);
			var py = new Array(nPoints);
			var cx = undefined;
			var cy = undefined;

			function plot( x, y, r, g, b, a )
			{
				var i = (y * nCanvasW + x) * 4; // 32-bit RGBA
				aTexels[i + 0] = r;
				aTexels[i + 1] = g;
				aTexels[i + 2] = b;
				aTexels[i + 3] = a;
			}

			function init_points()
			{
				for( var i = 0; i < nPoints; i++ )
				{
					var angle = i * Math.PI * 2.0 / nPoints;
					px[i] = nCanvasW / 2.0 + Math.cos(angle) * nCanvasW / 2.0;
					py[i] = nCanvasH / 2.0 + Math.sin(angle) * nCanvasH / 2.0;
					plot( Math.floor(px[i]), Math.floor(py[i]), 0,0,0,255 );
				}
				cx = px[0];
				cy = py[0];
			}

			function update()
			{
				for (var j = 0; j < 10000; j++ )
				{
					var i = Math.floor(nPoints * Math.random());
					cx = (cx + px[i]) / 2;
					cy = (cy + py[i]) / 2;
					//plot( Math.floor(nCanvasW * Math.random()), Math.floor(nCanvasH * Math.random()), 255,0,0,255 );
					plot( Math.floor(cx), Math.floor(cy), 0,0,0,255 );
				}
				hContext.putImageData( tImage, 0, 0 );
			}

			function main_function()
			{
				hCanvas  = document.getElementById("MyCanvas");
				hContext = hCanvas.getContext("2d");
				nCanvasW = hCanvas.width;
				nCanvasH = hCanvas.height;
				tImage   = hContext.getImageData(0, 0, nCanvasW, nCanvasH);
				aTexels  = tImage.data; 

				init_points();
				nTimerId = setInterval( function() { update(); }, 1000 / 60 );
			}
			
			// DOESN'T WORK WITH htmlpreview.github.io
			// window.onload = main_function;
			
			// TRYING 
			// anonymous function that is defined and run when defined
			(function () {
				main_function();
			})();
		</script>
	</body>
</html>
